### <a name="_b7urdng99y53"></a>**Название задачи:** Проектирование схем коллекций для шардирования данных
### <a name="_hjk0fkfyohdk"></a>**Автор:** Щуренков Максим
### <a name="_uanumrh8zrui"></a>**Дата:** 09.11.2025

### <a name="_3bfxc9a45514"></a>**Коллекция orders**

**Схема коллекции orders**

```json
{
  "_id": "ObjectId",
  "user_id": "ObjectId",
  "order_date": "ISODate",
  "items": [
    {
      "product_id": "ObjectId",
      "price": "number", 
    }
  ],
  "status": "string",
  "total_price": "number", 
  "geo_zone": "string" 
}
```

**Основные операции**
* Быстрое создание заказов с одновременным списанием остатков.
* Поиск истории заказов конкретного пользователя.
* Отображение статуса заказа.

**Решение**

* Шард-ключ: `{ "user_id": "hashed" }`
* Стратегия шардирования: Hash-Based
* Обоснование: 
    1) Равномерное распределение по шардам
    2) Создание заказа, поиск истории конкретного пользователя, отображение статуса заказа - задействуют всегда один и тот же шард.

**Альтернатива**

* Шард-ключ: `{ "user_id": "1" }`
* Стратегия шардирования: Range-Based
* Преимущества: Простота поддержки (Администратору проще понимать заказы каких пользователей находятся на каких шардах)
* Недостатки: Неравномерность распределения, учёт user_id, которые ниразу не делали заказы

**Недостатки, ограничения, риски**

Не учитываются пользователи, которые всегда совершают крупные заказы. Например, оптовый покупатель, заказы которого, могут так же находиться в данной базе.

### <a name="_3bfxc9a45514"></a>**Коллекция products**

**Схема коллекции products**

```json
{
  "_id": "ObjectId",
  "name": "string",
  "category": "string",
  "price": "number", 
  "stock": [
    {
      "zone": "string",
      "quantity": "int"
    }
  ],
  "attributes": [
    {
      "key": "string",
      "value": "string"
    }
  ]
}
```

**Основные операции**

* Частые обновления остатков при покупках.
* Поиск товаров по категориям и фильтрация по диапазону цен.
* Описание товара на странице продукта.

**Решение**

* Шард-ключ: 
* Стратегия шардирования: 
* Обоснование: 

**Альтернатива**

**Недостатки, ограничения, риски**


